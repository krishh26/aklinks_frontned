<div class="dashboard-container" [class.sidebar-closed]="!isSidebarOpen">
  <!-- Shared Sidebar -->
  <app-sidebar [isOpen]="isSidebarOpen" (sidebarToggle)="toggleSidebar()"></app-sidebar>

  <!-- Mobile Sidebar Overlay -->
  <div class="sidebar-overlay" *ngIf="isSidebarOpen" (click)="closeSidebar()"></div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Admin Header -->
    <app-admin-header [isSidebarOpen]="isSidebarOpen" (sidebarToggle)="toggleSidebar()"></app-admin-header>

    <!-- Support List Content -->
    <section class="support-management">
      <!-- Breadcrumbs -->
      <nav class="breadcrumbs">
        <a routerLink="/admin/dashboard" class="breadcrumb-link">Home</a>
        <span class="breadcrumb-separator">></span>
        <span class="breadcrumb-current">Support List</span>
      </nav>

      <!-- Page Title -->
      <h1 class="page-title">Support List</h1>

      <!-- Filters Section -->
      <div class="filters-section">
        <div class="search-box">
          <input
            type="text"
            placeholder="Search by name, email, subject, or message..."
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
            class="form-input"
          />
        </div>

        <div class="filter-group">
          <select
            id="status-filter"
            [(ngModel)]="selectedStatus"
            (change)="onStatusChange()"
            class="form-select"
          >
            <option value="all">All Status</option>
            <option value="pending">Pending</option>
            <option value="resolved">Resolved</option>
            <option value="closed">Closed</option>
          </select>
        </div>
      </div>

      <!-- Support Tickets Table -->
      <div class="table-container">
        <div *ngIf="isLoading" class="loading">
          <p>Loading support tickets...</p>
        </div>

        <table *ngIf="!isLoading" class="support-table">
          <thead>
            <tr>
              <th>NAME</th>
              <th>EMAIL</th>
              <th>SUBJECT</th>
              <th>MESSAGE</th>
              <th>STATUS</th>
              <th>CREATED AT</th>
              <th>ACTION</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let ticket of filteredTickets">
              <td class="name-cell">{{ ticket.name || 'N/A' }}</td>
              <td class="email-cell">{{ ticket.email }}</td>
              <td class="subject-cell">{{ ticket.subject }}</td>
              <td class="message-cell">
                <span class="message-preview">{{ (ticket.message || '').substring(0, 50) }}{{ (ticket.message || '').length > 50 ? '...' : '' }}</span>
              </td>
              <td>
                <span class="status-badge" [class.status-pending]="!ticket.status || ticket.status === 'pending'" [class.status-resolved]="ticket.status === 'resolved'" [class.status-closed]="ticket.status === 'closed'">
                  {{ ticket.status || 'Pending' | titlecase }}
                </span>
              </td>
              <td>{{ formatDate(ticket.createdAt) }}</td>
              <td>
                <div class="action-buttons">
                  <button
                    class="action-btn view-btn"
                    (click)="viewTicketDetails(ticket)"
                    title="View Details"
                  >
                    <span class="action-icon">üëÅÔ∏è</span>
                    View
                  </button>
                  <button
                    class="action-btn delete-btn"
                    (click)="deleteTicket(ticket)"
                    title="Delete Ticket"
                  >
                    <span class="delete-icon">üóëÔ∏è</span>
                    Delete
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredTickets.length === 0 && !isLoading">
              <td colspan="7" class="no-data">No support tickets found</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="!isLoading && totalFilteredTickets > limit">
        <div class="pagination-info">
          Showing {{ (currentPage - 1) * limit + 1 }} to {{ Math.min(currentPage * limit, totalFilteredTickets) }} of {{ totalFilteredTickets }} tickets ({{ limit }} per page)
        </div>
        <div class="pagination-controls">
          <button 
            class="pagination-btn" 
            [disabled]="currentPage === 1"
            (click)="onPageChange(currentPage - 1)"
            title="Previous Page">
            ‚Üê Previous
          </button>
          <span class="page-info">Page {{ currentPage }} of {{ totalFilteredPages }}</span>
          <button 
            class="pagination-btn" 
            [disabled]="currentPage === totalFilteredPages"
            (click)="onPageChange(currentPage + 1)"
            title="Next Page">
            Next ‚Üí
          </button>
        </div>
      </div>
    </section>
  </main>
</div>

